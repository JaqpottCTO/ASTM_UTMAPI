openapi: 3.1.1
info:
  title: ASTM UAM PSU OIM API
  description: "Interface definitions for the Operational Intent Management function within the Providers of Services to UAM (PSU)\ninteroperability network. Functionality includes sharing details of flight operational intents.\n "
  version: 0.0.0
servers:
- url: /
security:
- Authority:
  - utm.strategic_coordination
- Authority:
  - utm.conformance_monitoring_sa
- Authority:
  - utm.resource_management
- Authority:
  - utm.resource_processing
- Authority:
  - utm.availability_arbitration
 
tags:
- name: Operational intent details
  description: Endpoints exposed by PSU OIMs for interaction with details of operational intents.
- name: Telemetry
- name: Reports
  description: Endpoints exposed by the PSUs for reporting peer PSU issues.
- name: p2p_uam
  description: Endpoints exposed by PSUs for peer-peer communication.
paths:
  /oim/v1/operational_intents:
    $ref: '../shared-components/pathitems.yaml#/components/pathItems/path_OperationalIntentNotifications_Create'

  /oim/v1/operational_intents/{entityid}:
    $ref: '../shared-components/pathitems.yaml#/components/pathItems/path_OperationalIntentNotifications_GetAndUpdate'

  /oim/v1/resource_details:
    $ref: '../shared-components/pathitems.yaml#/components/pathItems/path_ResourceNotifications_Create'
    
  /oim/v1/resource_details/{entityid}:
    $ref: '../shared-components/pathitems.yaml#/components/pathItems/path_ResourceNotifications_Update'
        
  /oim/v1/conformance_alert/{entityid}:
    summary: |-
      endpoint hosted by OIM to allow CM to provide conformance monitoring alerts including for
      when an operation is detected to be taking off, when it is detected to be non conformant
      and when it is detected to be conformant after a nonconformance. This will usually required
      a change of state for teh operation by the OIM in the DSS
    put:
      tags:
      - Telemetry
      - p2p_uam
      summary: Alert a peer PSU by conformance monitoring.
      description: Notify a peer PSU directly with a conformance monitoring alert (usually requiring a change of state by the OIM in the DSS).
      operationId: notifyConformanceAlert
      parameters:
      - name: entityid
        in: path
        description: EntityID for the impacted operation.
        required: true
        style: simple
        explode: false
        schema:
          $ref: '../shared-components/schemas.yaml#/components/schemas/EntityID'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PutConformanceAlert'
        required: true
      responses:
        "204":
          description: New or updated full resource information received successfully.
        "400":
          description: |-
            * One or more parameters were missing or invalid.
            * The Entity could not be parsed, or contains illegal data.
          content:
            application/json:
              schema:
                $ref: '../shared-components/schemas.yaml#/components/schemas/ErrorResponse'
        "401":
          description: "Bearer access token was not provided in Authorization header, token could not be decoded, or token was invalid."
          content:
            application/json:
              schema:
                $ref: '../shared-components/schemas.yaml#/components/schemas/ErrorResponse'
        "403":
          description: |-
            * The access token was decoded successfully but did not include a scope appropriate to this endpoint.
            * The client identified in the access token is not the manager of this Entity according to the receiving client's records.
          content:
            application/json:
              schema:
                $ref: '../shared-components/schemas.yaml#/components/schemas/ErrorResponse'
        "409":
          description: |-
            The Entity version specified in this message is lower than
            a previously-received notification, or identical to a previously-received
            notification and the Entity is different.
          content:
            application/json:
              schema:
                $ref: '../shared-components/schemas.yaml#/components/schemas/ErrorResponse'
        "429":
          description: The client issued too many requests in a short period of time.
          content:
            application/json:
              schema:
                $ref: '../shared-components/schemas.yaml#/components/schemas/ErrorResponse'
      security:
      - Authority:
        - utm.conformance_monitoring_sa

  /oim/v1/reports:
    $ref: '../shared-components/pathitems.yaml#/components/pathItems/path_ErrorReports'

  /oim/v1/imbalance:
    summary: Submit details about a detected resource demand capacity imbalance
      to the OIM which manages the operation. 
    post:
      tags:
      - Imbalance monitoring 
      summary: Notify an OIM of a demand capacity balance which for which their operation 
        is contributing. 
      description: Notify an OIM of a demand capacity balance which for which their operation 
        is contributing. 
      operationId: notifyDCBImbalanceParticipant
      requestBody:
        content:
          application/json:
            schema:
              $ref: '../DCB/astm-uam-psu-dcb-0.0.0.yaml#/components/schemas/ImbalanceResponse'
        required: true
      responses:
        "204":
          description: DCB imbalance information received successfully.
        "400":
          description: |-
            * One or more parameters were missing or invalid.
            * The Entity could not be parsed, or contains illegal data.
          content:
            application/json:
              schema:
                $ref: '../shared-components/schemas.yaml#/components/schemas/ErrorResponse'
        "401":
          description: "Bearer access token was not provided in Authorization header, token could not be decoded, or token was invalid."
          content:
            application/json:
              schema:
                $ref: '../shared-components/schemas.yaml#/components/schemas/ErrorResponse'
        "403":
          description: |-
            * The access token was decoded successfully but did not include a scope appropriate to this endpoint.
            * The client identified in the access token is not the manager of this Entity according to the receiving client's records.
          content:
            application/json:
              schema:
                $ref: '../shared-components/schemas.yaml#/components/schemas/ErrorResponse'
        "409":
          description: |-
            The Entity version specified in this message is lower than
            a previously-received notification, or identical to a previously-received
            notification and the Entity is different.
          content:
            application/json:
              schema:
                $ref: '../shared-components/schemas.yaml#/components/schemas/ErrorResponse'
        "429":
          description: The client issued too many requests in a short period of time.
          content:
            application/json:
              schema:
                $ref: '../shared-components/schemas.yaml#/components/schemas/ErrorResponse'
      security:
      - Authority:
        - utm.strategic_coordination
  /oim/v1/extent_update:
    summary: Submit updated resource extents and trajectory back to OIM from DCB. This endpoint
      will be called in the case where a new resource is created or the physical definition
      of a resource is updating causing a flight's shared resource extents and trajectory to 
      be out of date.  This endpoint returns the same data as an imbalance intent request 
      on the DCB.  It indicates if the flight is DCB compliant or not (after the change), 
      provides details about imbalances, and also provides the updated resource extents and
      supplemental trajectory for updates to the DSS and other OIMs. 
    post:
      tags:
      - Imbalance monitoring 
      summary: Notify an OIM that the resource interaction of their existing operational intent
        is out of date and must be updated. 
      description: Notify an OIM that the resource interaction of their existing operational intent
        is out of date and must be updated. 
      operationId: notifyExtentsRequireUpdate
      requestBody:
        content:
          application/json:
            schema:
              $ref: '../DCB/astm-uam-psu-dcb-0.0.0.yaml#/components/schemas/ExtentUpdateRequest'
        required: true
      responses:
        "204":
          description: Extent update information received successfully.
        "400":
          description: |-
            * One or more parameters were missing or invalid.
            * The Entity could not be parsed, or contains illegal data.
          content:
            application/json:
              schema:
                $ref: '../shared-components/schemas.yaml#/components/schemas/ErrorResponse'
        "401":
          description: "Bearer access token was not provided in Authorization header, token could not be decoded, or token was invalid."
          content:
            application/json:
              schema:
                $ref: '../shared-components/schemas.yaml#/components/schemas/ErrorResponse'
        "403":
          description: |-
            * The access token was decoded successfully but did not include a scope appropriate to this endpoint.
            * The client identified in the access token is not the manager of this Entity according to the receiving client's records.
          content:
            application/json:
              schema:
                $ref: '../shared-components/schemas.yaml#/components/schemas/ErrorResponse'
        "409":
          description: |-
            The Entity version specified in this message is lower than
            a previously-received notification, or identical to a previously-received
            notification and the Entity is different.
          content:
            application/json:
              schema:
                $ref: '../shared-components/schemas.yaml#/components/schemas/ErrorResponse'
        "429":
          description: The client issued too many requests in a short period of time.
          content:
            application/json:
              schema:
                $ref: '../shared-components/schemas.yaml#/components/schemas/ErrorResponse'
      security:
      - Authority:
        - utm.strategic_coordination
  /oim/v1/log_sets/{log_set_id}:
    summary: General summary
    parameters:
    - name: log_set_id
      description: >-
        USS-defined identifier for a set of log entries.  For instance, this
        ID may refer to all logs associated with a particular reportable
        incident, or over a time range for the purpose of metric computation.
      schema:
        type: string
      in: path
      required: true
      example: com.example.incident.20200107.v4
    get:
      tags:
      - Logging
      summary: Get PSU logs
      operationId: getPSULogSet
      description: >-
        A PSU will not usually implement this endpoint directly, but rather will
        be capable of exporting log data in a format equivalent to the response
        format of this pseudo-endpoint according to the requirements of the
        standard.
      responses:
        '200':
          description: Log data successfully retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PSULogSet'
components:
  securitySchemes:
    Authority:
      $ref: '../shared-components/security.yaml#/components/securitySchemes/Authority'

  schemas:
    GetOperationalIntentDetailsResponse:
      required:
      - operational_intent
      type: object
      properties:
        operational_intent:
          $ref: '../shared-components/schemas.yaml#/components/schemas/OperationalIntent'
      description: Response to peer request for the details of operational intent with the given ID.
    GetOperationalIntentTelemetryResponse:
      required:
      - operational_intent_id
      - telemetry
      type: object
      properties:
        operational_intent_id:
          description: ID of the operational intent which the vehicle reporting telemetry is flying.
          $ref: '../shared-components/schemas.yaml#/components/schemas/EntityID'
        telemetry:
          $ref: '../DSS/astm-uam-psu-dss-0.0.0.yaml#/components/schemas/VehicleTelemetry'
        next_telemetry_opportunity:
          description: |-
            The next telemetry similar to this telemetry is not expected to be
            available until at or after this time, so the polling PSU should
            generally not poll the endpoint providing this response data again
            until at or after that time.  If this field is omitted, then there
            is no current expectation of new telemetry becoming available.
          $ref: '../shared-components/schemas.yaml#/components/schemas/Time'
      description: Response to a peer request for telemetry of an operational intent.
    PutConformanceAlert:
      description: |-
        Parameters for an alert about an operation from the CM role. 
      required:
      - alert
      type: object
      properties:
        alert:
          type: string
          description: |-
            Alert about an operation from the CM role.
            'Takeoff': Tracking information has been received indicating that the aircraft has taken off
            'Nonconforming': Tracking information has been received indicating that the aircraft is no longer in conformance with its coordinated (activated or DCB-Noncompliant) operational intent
            'Reconforming': Tracking information has been received indicating that the aircraft is in conformance with its coordinated (activated or DCB-Noncompliant) operational intent after being nonconforming. 
              Reconformance may be because the operation has regained conformance with its previously coordinated operational intent or because the intent has been updated.
          enum:
          - Takeoff
          - Nonconforming
          - Reconforming
    PSULogSet:
      type: object
      description: >-
        The set of log data fulfilling this standard's Logging requirements.
      properties:
        messages:
          description: >-
            Outgoing messages sent to other PSUs and the DSS, and incoming
            messages received from other PSUs, including instances where an
            expected response to a request is not received.
          type: array
          items:
            $ref: '../shared-components/schemas.yaml#/components/schemas/ExchangeRecord'
          default: [ ]
        operator_notifications:
          description: >-
            Instances of operator notifications as specifically required within
            this standard.
          type: array
          items:
            $ref: '#/components/schemas/UserNotificationRecord'
          default: [ ]
        operator_inputs:
          description: >-
            Instances of operator input as specifically required within this
            standard.
          type: array
          items:
            $ref: '#/components/schemas/UserInputRecord'
          default: [ ]
        operator_associations:
          description: >-
            For a PSU that manages operational intents, associations of an
            operator with operational intents that transitioned to the Accepted
            state.
          type: array
          items:
            $ref: '#/components/schemas/OperatorAssociation'
          default: [ ]
        planning_attempts:
          description: >-
            For a PSU that manages operational intents, instances where an
            operational intent could not be planned or replanned due to
            conflicts with other operational intents or constraints.
          type: array
          items:
            $ref: '#/components/schemas/PlanningRecord'
          default: [ ]
        operational_intent_positions:
          description: >-
            For a PSU performing conformance monitoring, all position data used
            for conformance monitoring that is ingested from the UA.
          type: array
          items:
            $ref: '#/components/schemas/OperationalIntentPositions'
          default: [ ]
    PositionRecord:
      required:
      - telemetry
      - time_received
      type: object
      properties:
        time_received:
          description: Time that this position data was received by the USS
          $ref: '../shared-components/schemas.yaml#/components/schemas/Time'
        telemetry:
          $ref: '../DSS/astm-uam-psu-dss-0.0.0.yaml#/components/schemas/VehicleTelemetry'
      description: A record of vehicle telemetry information received by this USS (typically for conformance monitoring).
    OperationalIntentPositions:
      required:
      - operational_intent_id
      type: object
      properties:
        positions:
          type: array
          items:
            $ref: '#/components/schemas/PositionRecord'
          default: []
        operational_intent_id:
          description: ID of the operational intent associated with `positions`
          $ref: '../shared-components/schemas.yaml#/components/schemas/EntityID'
      description: A record of position data gathered through the course of an operational intent
    PlanningRecord:
      required:
      - ovns
      - time
      type: object
      properties:
        time:
          description: Time that this planning event occurred
          $ref: '../shared-components/schemas.yaml#/components/schemas/Time'
        ovns:
          type: array
          description: OVNs the planning USS was aware of when it was planning the operational intent
          items:
            $ref: '../shared-components/schemas.yaml#/components/schemas/EntityOVN'
          default: []
        missing_operational_intents:
          type: array
          description: List of missing operational intents (for planning attempts that were denied by the DSS with code 409)
          items:
            $ref: '../shared-components/schemas.yaml#/components/schemas/EntityID'
          default: []
        missing_resources:
          type: array
          description: List of missing resources (for planning attempts that were denied by the DSS with code 409)
          items:
            $ref: '../shared-components/schemas.yaml#/components/schemas/EntityID'
          default: []
        operational_intent_id:
          description: ID of the operational intent being planned
          $ref: '../shared-components/schemas.yaml#/components/schemas/EntityID'
        problem:
          type: string
          description: A free text description of the problem(s) encountered during this planning attempt.
      description: A record of a single attempt to (successfully or unsuccessfully) create or modify an operational intent.
    UserNotificationRecord:
      required:
      - notification_time
      - notification_triggering_event
      - triggering_event_time
      type: object
      properties:
        triggering_event_time:
          description: Time of the notification triggering event
          $ref: '../shared-components/schemas.yaml#/components/schemas/Time'
        notification_time:
          description: Time at which the user was notified
          $ref: '../shared-components/schemas.yaml#/components/schemas/Time'
        notification_details:
          type: string
          description: "Description of information that was provided to the user, as per the referenced notification_triggering_event requirement"
        notification_triggering_event:
          type: string
          description: Requirement ID that pertains to the given notification
          enum:
          - GEN0400
          - GEN0410
          - ACM0020
          - ACM0040
      description: User notification record.
    UserInputRecord:
      required:
      - input_triggering_event
      - operational_intent_id
      - triggering_event_time
      type: object
      properties:
        triggering_event_time:
          description: Time in which user input was received by the USS
          $ref: '../shared-components/schemas.yaml#/components/schemas/Time'
        operational_intent_id:
          description: ID of the operational_intent ID pertaining to the user input
          $ref: '../shared-components/schemas.yaml#/components/schemas/EntityID'
        input_triggering_event:
          type: string
          description: Requirement ID that pertains to the given notification
          enum:
          - CM0030
          - CM0040
          - CM0045
          - CM0035
        input_details:
          type: string
          description: "Description of the information that was provided by the user, as per the referenced input_triggering_event requirement"
      description: User input record
    OperatorAssociation:
      required:
      - operational_intent_id
      - operator_id
      type: object
      properties:
        operational_intent_id:
          description: ID of operational intent to which this association pertains
          $ref: '../shared-components/schemas.yaml#/components/schemas/EntityID'
        operator_id:
          type: string
          description: Unique identifier of the operator responsible for the operational intent
      description: Association between an operational intent and the operator of that operational intent
